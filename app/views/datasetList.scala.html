@(datasets: List[models.Dataset], prev: String, next: String, limit: Int, listView: String, rightsForUser: Option[models.UserPermissions])(implicit user: Option[securesocial.core.Identity])

@import services.{DI, AppConfigurationService}
@import controllers.Datasets 
@import securesocial.core.{SocialUser, IdentityId, AuthenticationMethod}
@import _root_.util.Formatters.ellipsize 

@main("Datasets") {

<script src="@routes.Assets.at("javascripts/lib/masonry.pkgd.min.js")" type="text/javascript"></script>
<script src="@routes.Assets.at("javascripts/lib/imagesloaded.pkgd.min.js")" type="text/javascript"></script>

<div class="page-header">
  <h1>Datasets</h1>
</div>

<div class="row">
    <div class="col-md-12">
        <div class="btn-group btn-group-sm pull-right">
        	@if(listView == "list"){            
	            <button type="button" class="btn btn-default active" href="#list-view" id="list-view-btn"><span class="glyphicon glyphicon-th-list"></span></button>
	            <button type="button" class="btn btn-default" href="#tile-view" id="tile-view-btn"><span class="glyphicon glyphicon-th-large"></span></button>
            }
            @if(listView == "tiles"){            
	            <button type="button" class="btn btn-default" href="#list-view" id="list-view-btn"><span class="glyphicon glyphicon-th-list"></span></button>
	            <button type="button" class="btn btn-default active" href="#tile-view" id="tile-view-btn"><span class="glyphicon glyphicon-th-large"></span></button>
            }
        </div>
        <script>
            $(function() {
                $('#tile-view-btn').click(function() {
                  console.log('tile view');
                  $('#tile-view').removeClass('hidden');
                  $('#list-view').addClass('hidden');
                  $('#tile-view-btn').addClass('active');
                  $('#list-view-btn').removeClass('active');
                  $('#masonry').masonry().masonry({
                      itemSelector: '.post-box',
                      columnWidth: '.post-box',
                      transitionDuration: 4
                	 });
                });
                $('#list-view-btn').click(function() {
                  console.log('list view');
                  $('#tile-view').addClass('hidden');
                  $('#list-view').removeClass('hidden');
                  $('#list-view-btn').addClass('active');
                  $('#tile-view-btn').removeClass('active');
                });
            });
        </script>
    </div>
</div>

@if(listView == "list"){ 
<div class="row hidden" id="tile-view">
}
@if(listView == "tiles"){ 
<div class="row" id="tile-view">
}
	<div class="col-md-12">
		<div id="masonry">
		@datasets.map { dataset =>
		  <div class="post-box col-lg-3 col-md-3 col-sm-3">
		  <div class="panel panel-default">

              <div class="pull-right"><a href="#" title="Bookmark" class="pull-right bookmark-link">
                  <span class="glyphicon glyphicon-bookmark bookmark"></span>
              </a></div>

  			<div class="panel-body">
			  		@if(!dataset.thumbnail_id.isEmpty){
						<a href="@(routes.Datasets.dataset(dataset.id))">
							<img class="img-responsive" src="@(routes.Files.thumbnail(UUID(dataset.thumbnail_id.toString().substring(5,dataset.thumbnail_id.toString().length-1))))" alt="Thumbnail of @(dataset.name)">
						</a>
					}
			  	<div class="caption">
                    <h4><a href="@(routes.Datasets.dataset(dataset.id))">@dataset.name</a></h4>
                    <p>@ellipsize(dataset.description, 200)</p>
                </div>
			</div>
              <!-- Dataset Info -->
              <ul class="list-group">
                  <li class="list-group-item">
                      <span class="glyphicon glyphicon glyphicon-file" title="@dataset.files.size files"></span> @dataset.files.size
                      <span class="glyphicon glyphicon glyphicon-tags" title="@dataset.tags.size tags"></span>  @dataset.tags.size
                      <span class="glyphicon glyphicon glyphicon-list" title="@dataset.userMetadata.keys.size metadata fields"></span>  @dataset.userMetadata.keys.size
                  </li>
              </ul>
			</div>
    	  </div>
		}
		</div>

	</div>
</div>

@if(listView == "list"){ 
<div class="row" id="list-view">
}
@if(listView == "tiles"){ 
<div class="row hidden" id="list-view">
}
	<div class="col-md-12">
		<table class="table table-bordered table-hover">
			<thead>
				<tr>
					@if(user.isDefined) {
						<th style="width: 25%">Name</th>
						<th style="width: 15%">Created</th>
						<th style="width: 40%">Description</th>
						<th style="width: 15%">Preview</th>
						<th style="width: 5%">Delete</th>
					}
					@if(!user.isDefined) {
						<th style="width: 25%">Name</th>
						<th style="width: 15%">Created</th>
						<th style="width: 45%">Description</th>
						<th style="width: 15%">Preview</th>
					}
				</tr>
			</thead>
			<tbody>
					@datasets.map { dataset =>
						<tr>
							<td><a href="@(routes.Datasets.dataset(dataset.id))">@dataset.name</a></td>
							<td>@dataset.created.format("MMM dd, yyyy")</td>
							<td style="white-space:pre-line">@dataset.description</td>
							<td>
								@if(!dataset.thumbnail_id.isEmpty){<img src="@(routes.Files.thumbnail(UUID(dataset.thumbnail_id.toString().substring(5,dataset.thumbnail_id.toString().length-1))))" alt="Thumbnail of @(dataset.name)" width="120">}
								@if(dataset.thumbnail_id.isEmpty){No thumbnail available}
							</td>
							<td class="requiresLogin">
								@if(services.DI.injector.getInstance(classOf[controllers.Datasets]).checkAccessForDatasetUsingRightsList(dataset, user, "modify", rightsForUser)){
									<a href="#" onclick="removeDataset('@(dataset.id.toString)',event)" class="btn btn-link" style="text-align:right" title="Delete">
							    		<span class="glyphicon glyphicon-trash"></span>
							    	</a>
								}
							</td>						
						</tr>
					}
			</tbody>
		</table>
	</div>
</div>

<div class="row">
    <div class="col-md-12">
        <ul class="pager">
            @if(prev != "") {
            	<li class="previous"><a onclick="window.location='@(routes.Datasets.list("b", prev, limit))&listView='+(($('#list-view').is(':visible')) ? 'list' : 'tiles')" href="#">Previous</a></li>
            }
            @if(next != "") {
            	<li class="next"><a onclick="window.location='@(routes.Datasets.list("a", next, limit))&listView='+(($('#list-view').is(':visible')) ? 'list' : 'tiles')" href="#">Next</a></li>
            }
        </ul>
    </div>
</div>

@if(!user.isDefined) {
		<script type="text/javascript">
			$(".requiresLogin").css("display","none");
		</script>
	}
<script src="@routes.Assets.at("javascripts/datasetListProcess.js")" type="text/javascript"></script>
@util.masonry()
}


