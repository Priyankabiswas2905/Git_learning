@(extractions: Map[String, scala.collection.SortedMap[String, ExtractionGroup]], extractType: String)
<div class="well">
    @if(extractions.size == 0) {
        <p>No extraction events recorded.</p>
    } else {
        <table class="table">
            <thead>
                <th width="20%">Extractor</th>
                <th width="20%">Started</th>
                <th width="20%">Latest Update</th>
                <th width="40%">Latest Status</th>
            </thead>
            <tbody>
            @for(e <- extractions.keysIterator) {
                <tr>
                    <td colspan="4">
                        <a class="btn btn-link" data-toggle="collapse" data-target="#extractions-@e.replace('.','-')">
                            @e
                        </a>
                    </td>
                </tr>
                <tr class="collapse" id="extractions-@e.replace('.','-')">
                    <td colspan="4">
                        <table class="table">
                            <tbody>
                                @for(etime <- extractions(e).keysIterator) {
                                    <tr>
                                        <td>
                                            <a class="btn btn-link" data-toggle="collapse" data-target="#extractions-@e.replace('.','-')-@etime.replace(' ','-').replace(':','-')">@etime</a>
                                        </td>
                                        <td>@extractions(e)(etime).firstMsgTime</td>
                                        <td>@extractions(e)(etime).latestMsgTime</td>
                                        <td>@extractions(e)(etime).latestMsg</td>
                                    </tr>
                                    <tr class="collapse" id="extractions-@e.replace('.','-')-@etime.replace(' ','-').replace(':','-')">
                                        <td colspan="4">
                                            <table class="table">
                                                <tbody>
                                                    @for(e2 <- extractions(e)(etime).allMsgs) {
                                                        <tr>
                                                            <td width="19%"></td>
                                                            <td width="81%"><b>@e2.start</b><br/>
                                                                @if(e2.message_type == "SUBMITTED") {
                                                                    @e2.message_type
                                                                    <a class="btn btn-link" id='@(e2.id)' onclick="cancelSubmission('@(e2.file_id)', '@(e2.id)', '@(e2.extractor_id)', '@(extractType)')">
                                                                        Cancel
                                                                    </a>
                                                                } else {
                                                                    @e2.message_type - @e2.message
                                                                }
                                                        </tr>
                                                    }
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </td>
                </tr>
            }
            </tbody>
        </table>
    }
</div>
<script type="text/javascript">
        function cancelSubmission(id, submit_id, extractor_id, extractType) {
            console.log("cancel submit: " + id + ", submit id: " + submit_id);
            var dataBody = {'extractor': extractor_id};
            var apicall = null

            if (extractType == "dataset") {// dataset submission
                apicall = jsRoutes.api.Extractions.cancelDatasetExtractionSubmission
            } else if(extractType == "file"){
                apicall = jsRoutes.api.Extractions.cancelFileExtractionSubmission
            }
            var request = apicall(id, submit_id).ajax({
                data: JSON.stringify(dataBody),
                type: 'POST',
                contentType: "application/json",
            });

            request.done(function (response, textStatus, jqXHR){
                notify("Cancellation request has been submitted", "success");
            });

            request.fail(function (jqXHR, textStatus, errorThrown){
                console.error("The following error occured: " + textStatus, errorThrown);
            });
        }
</script>
